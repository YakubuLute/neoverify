<!-- eslint-disable @angular-eslint/template/click-events-have-key-events -->
<!-- eslint-disable @angular-eslint/template/interactive-supports-focus -->
    <div class="audit-entry-detail-container p-6">
      <!-- Header -->
      <div class="flex justify-between items-center mb-6">
        <div>
          <div class="flex items-center gap-3 mb-2">
            <p-button
              icon="pi pi-arrow-left"
              [text]="true"
              (onClick)="goBack()"
              pTooltip="Go back"
            />
            <h1 class="text-3xl font-bold text-white">Audit Entry Details</h1>
          </div>
          <p class="text-gray-400">Detailed information about this audit entry</p>
        </div>
        <div class="flex gap-3">
          @if (auditEntry()) {
            <p-button
              label="Copy Entry ID"
              icon="pi pi-copy"
              [outlined]="true"
              (onClick)="copyEntryId()"
            />
          }
          @if (auditEntry()?.documentId) {
            <p-button
              label="View Document"
              icon="pi pi-external-link"
              (onClick)="viewDocument()"
            />
          }
        </div>
      </div>

      <!-- Loading State -->
      @if (loading()) {
        <div class="flex justify-center items-center py-12">
          <p-progressSpinner />
        </div>
      }

      <!-- Entry Details -->
      @if (auditEntry() && !loading()) {
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Main Details -->
        <div class="lg:col-span-2 space-y-6">
          <!-- Basic Information -->
          <p-card header="Basic Information" class="bg-gray-100 backdrop-blur-sm border border-gray-700">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label for="entryId" class="text-sm font-medium text-gray-300 mb-2 block">Entry ID</label>
                <p class="text-white font-mono text-sm bg-gray-900 p-2 rounded">{{ auditEntry()?.id }}</p>
              </div>

              <div>
                <label for="timestamp" class="text-sm font-medium text-gray-300 mb-2 block">Timestamp</label>
                <div class="space-y-1">
                  <p class="text-white">{{ auditEntry()?.timestamp | date:'full' }}</p>
                  <p class="text-sm text-gray-400">{{ getRelativeTime(auditEntry()?.timestamp!) }}</p>
                </div>
              </div>

              <div>
                <label for="action" class="text-sm font-medium text-gray-300 mb-2 block">Action</label>
                <p-tag
                  [value]="getActionLabel(auditEntry()?.action!)"
                  [severity]="getActionSeverity(auditEntry()?.action!)"
                  class="text-sm"
                />
              </div>

              <div>
                <label for="user" class="text-sm font-medium text-gray-300 mb-2 block">User</label>
                <div class="space-y-1">
                  <p class="text-white">{{ auditEntry()?.userEmail }}</p>
                  <p class="text-sm text-gray-400 font-mono">{{ auditEntry()?.userId }}</p>
                </div>
              </div>

              @if (auditEntry()?.documentId) {
                <div>
                  <label for="documentId" class="text-sm font-medium text-gray-300 mb-2 block">Document ID</label>
                  <div class="flex items-center gap-2">
                    <p class="text-white font-mono text-sm">{{ auditEntry()?.documentId }}</p>
                    <p-button
                      icon="pi pi-external-link"
                      [text]="true"
                      size="small"
                      (onClick)="viewDocument()"
                      pTooltip="View document"
                    />
                  </div>
                </div>
              }

              @if (auditEntry()?.ipAddress) {
                <div>
                  <label for="ipAddress" class="text-sm font-medium text-gray-300 mb-2 block">IP Address</label>
                  <p class="text-white font-mono">{{ auditEntry()?.ipAddress }}</p>
                </div>
              }
            </div>
          </p-card>

          <!-- Status Changes -->
          @if (auditEntry()?.previousStatus || auditEntry()?.newStatus) {
            <p-card
              header="Status Changes"
              class="bg-gray-100 backdrop-blur-sm border border-gray-700"
            >
              <div class="flex items-center justify-center gap-4">
                @if (auditEntry()?.previousStatus) {
                  <div class="text-center">
                    <label for="previousStatus" class="text-sm font-medium text-gray-300 mb-2 block">Previous Status</label>
                    <p-tag
                      [value]="auditEntry()?.previousStatus!"
                      severity="secondary"
                      class="text-sm"
                    />
                  </div>
                }

                @if (auditEntry()?.previousStatus && auditEntry()?.newStatus) {
                  <i class="pi pi-arrow-right text-gray-400 text-xl"></i>
                }

                @if (auditEntry()?.newStatus) {
                  <div class="text-center">
                    <label for="newStatus" class="text-sm font-medium text-gray-300 mb-2 block">New Status</label>
                    <p-tag
                      [value]="auditEntry()?.newStatus!"
                      severity="success"
                      class="text-sm"
                    />
                  </div>
                }
              </div>

              @if (auditEntry()?.reason) {
                <div class="mt-4">
                  <label for="reason" class="text-sm font-medium text-gray-300 mb-2 block">Reason</label>
                  <p class="text-white bg-gray-900 p-3 rounded">{{ auditEntry()?.reason }}</p>
                </div>
              }
            </p-card>
          }

          <!-- Technical Details -->
          <p-card header="Technical Details" class="bg-gray-100 backdrop-blur-sm border border-gray-700">
            <div class="space-y-4">
              @if (auditEntry()?.userAgent) {
                <div>
                  <label for="userAgent" class="text-sm font-medium text-gray-300 mb-2 block">User Agent</label>
                  <p class="text-white text-sm bg-gray-900 p-3 rounded break-all">{{ auditEntry()?.userAgent }}</p>
                </div>
              }

              @if (auditEntry()?.details && hasDetails(auditEntry()?.details!)) {
                <div>
                  <label for="details" class="text-sm font-medium text-gray-300 mb-2 block">Additional Details</label>
                  <pre class="text-white text-sm bg-gray-900 p-3 rounded overflow-auto max-h-60">{{ formatDetails(auditEntry()?.details!) }}</pre>
                </div>
              }
            </div>
          </p-card>
        </div>

        <!-- Sidebar -->
        <div class="space-y-6">
          <!-- Document Information -->
          @if (document()) {
            <p-card
              header="Document Information"
              class="bg-gray-100 backdrop-blur-sm border border-gray-700"
            >
            <div class="space-y-4">
              <div>
                <label for="title" class="text-sm font-medium text-gray-300 mb-2 block">Title</label>
                <p class="text-white">{{ document()?.title }}</p>
              </div>

              <div>
                <label for="type" class="text-sm font-medium text-gray-300 mb-2 block">Type</label>
                <p-tag [value]="document()?.documentType!" severity="info" />
              </div>

              <div>
                <label for="status" class="text-sm font-medium text-gray-300 mb-2 block">Status</label>
                <p-tag [value]="document()?.status!" [severity]="getDocumentStatusSeverity(document()?.status!)" />
              </div>

              <div>
                <label for="uploadedAt" class="text-sm font-medium text-gray-300 mb-2 block">Uploaded</label>
                <p class="text-white text-sm">{{ document()?.uploadedAt | date:'short' }}</p>
              </div>

              <p-divider />

              <p-button
                label="View Full Document"
                icon="pi pi-external-link"
                [outlined]="true"
                class="w-full"
                (onClick)="viewDocument()"
              />
              </div>
            </p-card>
          }

          <!-- Related Entries -->
          @if (relatedEntries().length > 0) {
            <p-card
              header="Related Entries"
              class="bg-gray-100 backdrop-blur-sm border border-gray-700"
            >
            <p-timeline [value]="relatedEntries()" class="w-full">
              <ng-template pTemplate="content" let-entry>
                <div class="p-3 bg-gray-900/50 rounded cursor-pointer hover:bg-gray-900/70 transition-colors"
                     (click)="viewRelatedEntry(entry.id)">
                  <div class="flex items-center justify-between mb-2">
                    <p-tag
                      [value]="getActionLabel(entry.action)"
                      [severity]="getActionSeverity(entry.action)"
                      class="text-xs"
                    />
                    <span class="text-xs text-gray-400">{{ entry.timestamp | date:'short' }}</span>
                  </div>
                  <p class="text-sm text-white">{{ entry.userEmail }}</p>
                </div>
              </ng-template>
            </p-timeline>

            @if (relatedEntries().length >= 5) {
              <div class="mt-4">
                <p-button
                  label="View All Related"
                  [text]="true"
                  class="w-full"
                  (onClick)="viewAllRelated()"
                />
              </div>
            }
            </p-card>
          }

          <!-- Quick Actions -->
          <p-card header="Quick Actions" class="bg-gray-100 backdrop-blur-sm border border-gray-700">
            <div class="space-y-3">
              <p-button
                label="Export Entry"
                icon="pi pi-download"
                [outlined]="true"
                class="w-full"
                (onClick)="exportEntry()"
              />

              @if (auditEntry()?.userId) {
                <p-button
                  label="View User Activity"
                  icon="pi pi-user"
                  [outlined]="true"
                  class="w-full"
                  (onClick)="viewUserActivity()"
                />
              }

              <p-button
                label="Search Similar"
                icon="pi pi-search"
                [outlined]="true"
                class="w-full"
                (onClick)="searchSimilar()"
              />
            </div>
          </p-card>
        </div>
        </div>
      }

      <!-- Error State -->
      @if (error() && !loading()) {
        <div class="text-center py-12">
          <i class="pi pi-exclamation-triangle text-4xl text-red-400 mb-4"></i>
          <h3 class="text-xl font-semibold text-white mb-2">Entry Not Found</h3>
          <p class="text-gray-400 mb-4">The requested audit entry could not be found.</p>
          <p-button
            label="Go Back"
            icon="pi pi-arrow-left"
            (onClick)="goBack()"
          />
        </div>
      }
    </div>
