<!-- Document Search Component -->
<div class="document-search">

    <!-- Search Input -->
    <div class="search-input-container">
        <span class="p-input-icon-left search-wrapper">
            <i class="pi pi-search search-icon"></i>
            <input type="text" pInputText [placeholder]="searchPlaceholder" [formControl]="searchControl"
                class="search-input">
        </span>

        <!-- Search Actions -->
        <div class="search-actions">
            @if (hasActiveFilters()) {
            <p-button icon="pi pi-filter-slash" [text]="true" (onClick)="onClearFilters()" pTooltip="Clear all filters"
                class="clear-filters-btn">
            </p-button>
            }

            <p-button icon="pi pi-search" [text]="true" pTooltip="Advanced search" class="advanced-search-btn">
            </p-button>
        </div>
    </div>

    <!-- Advanced Filters Panel -->
    @if (showAdvancedFilters) {
    <div class="advanced-filters-panel">
        <div class="filters-header">
            <h3 class="filters-title">
                <i class="pi pi-filter"></i>
                Advanced Filters
            </h3>

            @if (hasActiveFilters()) {
            <p-button label="Clear All" [text]="true" size="small" (onClick)="onClearFilters()" class="clear-all-btn">
            </p-button>
            }
        </div>

        <div class="filters-content">

            <!-- Document Type Filter -->
            <div class="filter-group">
                <label class="filter-label">
                    <i class="pi pi-file"></i>
                    Document Type
                </label>
                <p-multiSelect [options]="documentTypeOptions" optionLabel="label" optionValue="value"
                    placeholder="Select document types" [value]="getCurrentDocumentTypes()"
                    (onChange)="onDocumentTypeChange($event.value)" [showClear]="true" class="filter-multiselect">
                    <ng-template pTemplate="selectedItems" let-value>
                        @if (value && value.length > 0) {
                        <div class="selected-items">
                            @if (value.length <= 2) { @for (item of value; track item) { <p-tag
                                [value]="documentTypeOptions.find(opt => opt.value === item)?.label" severity="info">
                                </p-tag>
                                }
                                } @else {
                                <p-tag [value]="value.length + ' types selected'" severity="info"></p-tag>
                                }
                        </div>
                        }
                    </ng-template>
                </p-multiSelect>
            </div>

            <!-- Status Filter -->
            <div class="filter-group">
                <label class="filter-label">
                    <i class="pi pi-circle"></i>
                    Document Status
                </label>
                <p-multiSelect [options]="statusOptions" optionLabel="label" optionValue="value"
                    placeholder="Select status" [value]="getCurrentStatuses()" (onChange)="onStatusChange($event.value)"
                    [showClear]="true" class="filter-multiselect">
                    <ng-template pTemplate="selectedItems" let-value>
                        @if (value && value.length > 0) {
                        <div class="selected-items">
                            @if (value.length <= 2) { @for (item of value; track item) { <p-tag
                                [value]="statusOptions.find(opt => opt.value === item)?.label" severity="secondary">
                                </p-tag>
                                }
                                } @else {
                                <p-tag [value]="value.length + ' statuses selected'" severity="secondary"></p-tag>
                                }
                        </div>
                        }
                    </ng-template>
                </p-multiSelect>
            </div>

            <!-- Verification Status Filter -->
            <div class="filter-group">
                <label class="filter-label">
                    <i class="pi pi-verified"></i>
                    Verification Status
                </label>
                <p-multiSelect [options]="verificationStatusOptions" optionLabel="label" optionValue="value"
                    placeholder="Select verification status" [value]="getCurrentVerificationStatuses()"
                    (onChange)="onVerificationStatusChange($event.value)" [showClear]="true" class="filter-multiselect">
                    <ng-template pTemplate="selectedItems" let-value>
                        @if (value && value.length > 0) {
                        <div class="selected-items">
                            @if (value.length <= 2) { @for (item of value; track item) { <p-tag
                                [value]="verificationStatusOptions.find(opt => opt.value === item)?.label"
                                severity="success"></p-tag>
                                }
                                } @else {
                                <p-tag [value]="value.length + ' statuses selected'" severity="success"></p-tag>
                                }
                        </div>
                        }
                    </ng-template>
                </p-multiSelect>
            </div>

            <!-- Date Range Filter -->
            <div class="filter-group">
                <label class="filter-label">
                    <i class="pi pi-calendar"></i>
                    Upload Date Range
                </label>
                <p-datePicker selectionMode="range" placeholder="Select date range" [value]="getCurrentDateRange()"
                    (onSelect)="onDateRangeChange($event)" [showClear]="true" dateFormat="mm/dd/yy"
                    class="filter-datepicker">
                </p-datePicker>
            </div>

            <!-- Issuer Filter -->
            <div class="filter-group">
                <label class="filter-label">
                    <i class="pi pi-building"></i>
                    Issuer Organization
                </label>
                <p-multiSelect [options]="[]" optionLabel="name" optionValue="id" placeholder="Select issuers"
                    [value]="getCurrentIssuers()" (onChange)="onIssuerChange($event.value)" [showClear]="true"
                    class="filter-multiselect">
                </p-multiSelect>
            </div>

            <!-- Tags Filter -->
            <div class="filter-group">
                <label class="filter-label">
                    <i class="pi pi-tags"></i>
                    Tags
                </label>
                <p-multiSelect [options]="[]" optionLabel="name" optionValue="value" placeholder="Select tags"
                    [value]="getCurrentTags()" (onChange)="onTagsChange($event.value)" [showClear]="true"
                    [filter]="true" filterPlaceholder="Search tags" class="filter-multiselect">
                </p-multiSelect>
            </div>

        </div>

        <!-- Filter Summary -->
        @if (hasActiveFilters()) {
        <div class="filter-summary">
            <div class="summary-header">
                <span class="summary-title">Active Filters:</span>
            </div>

            <div class="summary-tags">
                @if (searchControl.value) {
                <p-tag [value]="'Search: ' + searchControl.value" severity="info" [removable]="true"
                    (onRemove)="searchControl.setValue('')">
                </p-tag>
                }

                @if (getCurrentDocumentTypes().length > 0) {
                <p-tag [value]="'Types: ' + getCurrentDocumentTypes().length" severity="info" [removable]="true"
                    (onRemove)="onDocumentTypeChange([])">
                </p-tag>
                }

                @if (getCurrentStatuses().length > 0) {
                <p-tag [value]="'Status: ' + getCurrentStatuses().length" severity="secondary" [removable]="true"
                    (onRemove)="onStatusChange([])">
                </p-tag>
                }

                @if (getCurrentVerificationStatuses().length > 0) {
                <p-tag [value]="'Verification: ' + getCurrentVerificationStatuses().length" severity="success"
                    [removable]="true" (onRemove)="onVerificationStatusChange([])">
                </p-tag>
                }

                @if (getCurrentDateRange()) {
                <p-tag value="Date Range" severity="warning" [removable]="true" (onRemove)="onDateRangeChange(null)">
                </p-tag>
                }
            </div>
        </div>
        }
    </div>
    }

    <!-- Quick Filters -->
    <div class="quick-filters">
        <div class="quick-filter-chips">
            <p-button label="All Documents" [text]="true" size="small" [class.active]="!hasActiveFilters()"
                (onClick)="onClearFilters()">
            </p-button>

            <p-button label="Verified Only" [text]="true" size="small"
                [class.active]="getCurrentVerificationStatuses().includes(VerificationStatus.VERIFIED)"
                (onClick)="onVerificationStatusChange([VerificationStatus.VERIFIED])">
            </p-button>

            <p-button label="Pending Verification" [text]="true" size="small"
                [class.active]="getCurrentVerificationStatuses().includes(VerificationStatus.PENDING)"
                (onClick)="onVerificationStatusChange([VerificationStatus.PENDING])">
            </p-button>

            <p-button label="Certificates" [text]="true" size="small"
                [class.active]="getCurrentDocumentTypes().includes(DocumentType.CERTIFICATE)"
                (onClick)="onDocumentTypeChange([DocumentType.CERTIFICATE])">
            </p-button>

            <p-button label="Degrees" [text]="true" size="small"
                [class.active]="getCurrentDocumentTypes().includes(DocumentType.DEGREE)"
                (onClick)="onDocumentTypeChange([DocumentType.DEGREE])">
            </p-button>
        </div>
    </div>

</div>